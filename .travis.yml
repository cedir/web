language: python
cache: pip
python:
    - "2.7"
env:
    -DJANGO=1.8 DB=postgresql
services:
  - postgresql
before_install:
  - sudo apt-get -y install libpq-dev libjpeg-dev
install:
    - pip install -r requirements-travis.txt
    - mkdir logs
    - cp settings-travis.py settings.py
    - npm install newman@4.6.1
before_script:
    - node --version
    - npm --version
    - node_modules/.bin/newman --version
    - psql -c 'create database test_db;' -U postgres
    - python manage.py migrate
    - python manage.py loaddata fixtures/*.json
    - python manage.py shell -c "from django.contrib.auth.models import User; User.objects.create_user('asd', 'asd@asd.com', 'asd')"
script:
    - python manage.py test
    - pylint caja/ comprobante/ estudio/ medico/ medicamento/ obra_social/ paciente/ practica/ presentacion/ sala/ scripts/ security/ turno/ usuario/
    - python manage.py runserver & node_modules/.bin/newman run integration_tests/cedir_web.postman_collection.json -e integration_tests/local.postman_environment.json --verbose